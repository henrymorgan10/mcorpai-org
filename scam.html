<!-- Paste this inside <body>. No outer <html>/<head>/<body> wrappers. -->
<style>
:root{color-scheme:light dark}
@media (min-width:992px){#infoRail{position:fixed;left:14px;top:150px;width:160px;z-index:80;transition:width .22s ease}#infoRail:hover,#infoRail:focus-within{width:min(345px,32vw)}}
@media (max-width:991.98px){#infoRail{position:fixed;left:10px;bottom:12px;width:min(75vw,280px);z-index:80;transition:width .22s ease}#infoRail:hover,#infoRail:focus-within{width:min(100vw,530px)}}
#box{background:#fffbea;border:1px solid rgba(0,0,0,.12);border-radius:8px;box-shadow:0 6px 14px rgba(2,6,23,.08);overflow:hidden;font:.8rem/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:#0b1221;opacity:.42;filter:saturate(.9) contrast(.95);transition:max-height .24s ease,opacity .18s ease,filter .18s ease,box-shadow .18s ease,transform .18s ease;max-height:var(--collapsed-h,424px);position:relative}
#box header{padding:4px 6px;font-weight:800;background:linear-gradient(180deg,#fffbea,#fff7d6);border-bottom:1px solid rgba(0,0,0,.08);font-size:.82rem;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
#box header > .title{color:#0b3d91;font-weight:900}
#box .row{padding:4px 6px}
#box:hover,#box:focus-within,#box.active{opacity:1;filter:none;box-shadow:0 10px 22px rgba(2,6,23,.12);transform:translateY(-1px);max-height:var(--expanded-h,1000px)}
#controls{display:grid;grid-template-columns:1fr auto;gap:4px;align-items:center}
#q{min-width:0;flex:1;padding:3px 5px;border:1px solid rgba(0,0,0,.16);border-radius:6px;outline:none;font-size:.72rem}
#riskBtn{padding:3px 6px;border-radius:6px;border:1px solid #e8b7b7;background:#ffe1e1;color:#7a2a2a;font-weight:800;cursor:pointer;font-size:.72rem}
#name{font-weight:800;color:#0b1221}
.badge{font-weight:800}.green{color:#16a34a}.black{color:#0b1221}.red{color:#b01919}.brkt{font-weight:700}
#desc{color:#0b0f19;font-weight:700;font-size:.78rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}
#more{font-size:.72rem;color:#0b1221}
#period{font-size:.72rem;opacity:.95;margin-top:2px}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
#infoRail:hover #desc,#infoRail:focus-within #desc{display:block;-webkit-line-clamp:unset;-webkit-box-orient:unset;overflow:visible}
#infoRail:hover #more,#infoRail:focus-within #more{overflow:visible}
</style>
<aside id="infoRail" aria-label="Sticky world travel ticker">
  <div id="box" role="group">
    <header>
      <div class="title" id="title">World Travel Ticker AI</div>
      <div id="period">Assessed 2020-01-01 to 2024-10-01 【 Moody’s 5yr avg: — 】</div>
    </header>
    <div class="row" id="controls">
      <input id="q" list="countries" placeholder="Country… (ex. America or USA)" autocomplete="off"/>
      <datalist id="countries"></datalist>
      <button id="riskBtn" type="button" title="Show risky countries">Risk</button>
    </div>
    <div class="row" id="view" aria-live="polite">
      <div id="name">—</div>
      <div id="rank">—</div>
      <div id="grade">—</div>
      <div id="desc">Choose a country or press Risk.</div>
      <div id="more"></div>
    </div>
    <div id="sr" class="sr-only" aria-live="polite"></div>
  </div>
</aside>
<script>
(function(){
  // Rotation timings (hover toggles 20s → 40s)
  const ROT_DEFAULT=20000, ROT_HOVER=40000, USER_LOCK_MS=40000, COLLAPSE_PCT=0.60, MIN_COLLAPSED=424;
  let rotDelay=ROT_DEFAULT;

  const box=document.getElementById('box'), q=document.getElementById('q'), dl=document.getElementById('countries'), riskBtn=document.getElementById('riskBtn');
  const elT=document.getElementById('title'), elP=document.getElementById('period');
  const elN=document.getElementById('name'), elR=document.getElementById('rank'), elG=document.getElementById('grade'), elD=document.getElementById('desc'), elM=document.getElementById('more'), sr=document.getElementById('sr'), view=document.getElementById('view');

  // Static English labels
  const LABELS={title:'World Travel Ticker AI', assessed:'Assessed', to:'to', moody:"Moody's 5yr avg", placeholder:'Country… (ex. America or USA)', risk:'Risk', choose:'Choose a country or press Risk.', sgrade:'Safety Grade', rank:'Tourism Rank #', micro:'Micronation', notun:'not a UN state'};
  elT.textContent=LABELS.title; q.setAttribute('placeholder',LABELS.placeholder); riskBtn.textContent=LABELS.risk;

  // Grade explanations (EN)
  const GEXP={"A+":"Exceptional safety across regions.","A":"Very safe, though not absolute best.","A-":"Safe overall with minor caveats.","B+":"Generally safe for visitors.","B":"Safe, some instability to watch.","B-":"Mostly safe, borderline in parts.","C+":"Acceptable but uneven safety.","C":"Fine by day, caution at night.","C-":"Daytime ok, avoid roaming at night.","D+":"Poor safety in notable areas.","D":"Poor; metro zones only feel stable.","D-":"Poor; even metro areas feel risky.","E+":"Very poor; avoid travel, escort advised. ☠️","E":"Very poor; escort advised, avoid travel. ☠️","E-":"Extremely poor; do not visit. ☠️","F":"Worst level; absolute no-go. ☠️☠️","NA":"Information limited between 2020–2024; consult official guidance."};

  const riskRe=/^(D|E|F)/;
  const gradeOrder={"F":0,"E-":1,"E":2,"E+":3,"D-":4,"D":5,"D+":6,"C-":7,"C":8,"C+":9,"B-":10,"B":11,"B+":12,"A-":13,"A":14,"A+":15,"NA":99};

  // Moody's 5-year average (subset; default to None). Keys by canonical country name.
  const MOODYS={'Luxembourg':'Aaa','Germany':'Aaa','Switzerland':'Aaa','Norway':'Aaa','Denmark':'Aaa','Sweden':'Aaa','Netherlands':'Aaa','Finland':'Aaa','Austria':'Aa1','United States':'Aaa','Canada':'Aaa','Australia':'Aaa','New Zealand':'Aaa','Singapore':'Aaa','United Kingdom':'Aa3','France':'Aa2','Japan':'A1','Italy':'Baa3','Spain':'Baa1','Ireland':'A1','Portugal':'Baa2','Mexico':'Baa2','Brazil':'Ba2','India':'Baa3','South Africa':'Ba2','Turkey':'B3','United Arab Emirates':'Aa2','Saudi Arabia':'A1','Qatar':'Aa2','Korea, Republic of (South Korea)':'Aa2','China':'A1'};
  function moodysColor(r){ if(!r||/^NR$/i.test(r)||/^None$/i.test(r)) return 'black'; if(/^WR$/i.test(r)) return 'red'; if(/^(Aaa|Aa|A|Baa)/.test(r)) return 'green'; if(/^(Ba|B[1-3]?$)/.test(r)) return 'black'; if(/^(Caa|Ca|C)$/i.test(r)) return 'red'; return 'black' }
  function creditInfo(name){ const r=MOODYS[name]||MOODYS[(name||'').toLowerCase()]||'None'; const skull=/^WR$/i.test(r)?' ☠️':''; return {text:r+skull, cls:moodysColor(r)} }
  function gColor(g){if(/^A|^B/.test(g))return'green';if(/^C|NA$/.test(g))return'black';return'red'}

  // Food suggestions (3 items) — minimal set + fallback
  const FOODS={
    'Japan':['sushi','ramen','okonomiyaki'],'United States':['burger','BBQ','clam chowder'],'France':['croissant','crêpe','coq au vin'],'Italy':['pizza','pasta','gelato'],'Spain':['paella','tapas','churros'],'Thailand':['pad thai','som tam','tom yum'],
    'Korea, Republic of (South Korea)':['bibimbap','bulgogi','kimchi stew'],'China':['dumplings','hot pot','Peking duck'],'Germany':['bratwurst','pretzel','schnitzel'],'United Kingdom':['fish and chips','pie and mash','full English'],
    'Mexico':['tacos','mole','pozole'],'Turkey':['kebap','baklava','lahmacun'],'Malaysia':['nasi lemak','satay','laksa'],'Singapore':['chicken rice','laksa','chilli crab'],'Portugal':['pastel de nata','bacalhau','francesinha'],
    'Canada':['poutine','butter tart','Nanaimo bar'],'Australia':['meat pie','lamington','barramundi'],'New Zealand':['lamb','hokey pokey','green-lipped mussels']
  };
  function foodsLine(name){ const arr=FOODS[name]||['local street food','the national dish','a signature dessert']; return 'Recommended foods: '+arr[0]+', '+arr[1]+', '+arr[2]+'.' }

  // Persist
  const LS_KEY='wtta.last';
  function save(c){try{localStorage.setItem(LS_KEY,c)}catch(e){}}
  function load(){try{return localStorage.getItem(LS_KEY)||''}catch(e){return''}}

  // Utils
  function pick(a){return a[Math.floor(Math.random()*a.length)]}
  function asString(x){ if(typeof x==='string') return x; if(x&&typeof x.name==='string') return x.name; return '' }
  function cleanInput(v){ return asString(v).replace(/\s*\((risk|safe\s*#\d+|micronation|info\-limited)\)\s*$/i,'').trim() }
  function trim(s){return (typeof s==='string'?s:'').replace(/\s+/g,' ').trim()}
  function grams(s){ s=asString(s).toLowerCase(); s=(' '+s+' ').replace(/[^a-z\s]/g,''); const g=new Set(); for(let i=0;i<s.length-2;i++) g.add(s.slice(i,i+3)); return g }
  function jacc(a,b){const A=grams(a),B=grams(b);let inter=0;A.forEach(x=>{if(B.has(x))inter++});return inter/Math.max(1,A.size+B.size-inter)}
  function bestMatch(name){
    const ALIAS={ 'usa':'united states','us':'united states','u.s.':'united states','america':'united states','united states of america':'united states','uk':'united kingdom','britain':'united kingdom','england':'united kingdom','kr':'korea, republic of (south korea)','korea':'korea, republic of (south korea)','south korea':'korea, republic of (south korea)','republic of korea':'korea, republic of (south korea)','jp':'japan','jpn':'japan','nippon':'japan','uae':'united arab emirates','emirates':'united arab emirates','ksa':'saudi arabia','cote d\'ivoire':'côte d’ivoire','cote d’ivoire':'côte d’ivoire','vietnam':'viet nam','russia':'russian federation'};
    const norm=(s)=>{ s=asString(s).toLowerCase().trim(); return ALIAS[s]||s };
    const s=norm(name); if(!s) return ''; if(DB[s]) return s; let best='',sc=0; for(const k of Object.keys(DB)){const v=jacc(s,k); if(v>sc){sc=v;best=k}} return sc>.18?best:'';
  }

  function micro(){return 'Safety Grade A+ to F. Grades reflect public guidance on crime, night risk, transit safety, and access to help.'}
  function core(o){ if(o.type==='micro') return trim(o.pitch); const a=[];a.push('Money '+o.cost+'.');a.push(' English '+o.eng+'.');a.push(' Exchange '+o.fx+'.');a.push(' Risks '+(o.r1||'—').toLowerCase()+', '+(o.r2||'—').toLowerCase()+'.');a.push(' Tip '+o.tip+'.');return trim(a.join(''))}
  function full(o){ if(o.type==='micro') return trim(o.story); const s=[]; const exp=GEXP[o.grade||'NA']||GEXP.NA; s.push('<strong>'+LABELS.sgrade+' <span class="badge '+gColor(o.grade)+'">'+(o.grade||'NA')+'</span></strong> <span class="brkt">【 '+exp+' 】</span>'); s.push('Money '+(o.cost||'Unknown')+'.'); s.push(' English '+(o.eng||'Unknown')+'.'); s.push(' Exchange '+(o.fx||'Unknown')+'.'); s.push(' Issues: '+(o.r1||'—').toLowerCase()+', '+(o.r2||'—').toLowerCase()+'.'); s.push(' Tips: use official rides, keep phones pocketed curbside, and confirm prices before rides.'); s.push(' '+foodsLine(o.name)); return trim(s.join(' ')) }
  function mkObj(line){const p=(line||'').split('|');const name=p[0]||'';const rank=p[1]||'-';const grade=p[2]||'C';const cost=p[3]||'Moderate';const eng=p[4]||'Moderate';const fx=p[5]||'Moderate';const r1=p[6]||'Theft';const r2=p[7]||'Scams';const tip=p[8]||'Use official options';return {key:asString(name).toLowerCase(),name:asString(name),rank:rank==='-'?null:Number(rank),grade,cost,eng,fx,r1,r2,tip}};

  // Base data (sample + risk). Additional coverage auto-added for all UN members.
  const TOK=[
    'France|1|A-|Expensive|Moderate|Easy|Pickpockets|Transit scams|Book top museums in advance to avoid lines',
    'Spain|2|B+|Moderate|Moderate|Easy|Bag snatch|Beach theft|Use lockers and keep bags zipped on metros',
    'United States|3|B|Expensive|Easy|Easy|Car break-ins|Card fraud|Use park-and-ride and tap-to-pay where possible',
    'China|4|B|Moderate|Difficult|Moderate|Taxi scams|Tea scams|Use official apps and avoid unsolicited invites',
    'Italy|5|B+|Moderate|Moderate|Easy|Station pickpockets|Distraction|Board trains early and keep bags in sight',
    'Turkey|6|B|Cheap|Moderate|Easy|Taxi overcharge|Counterfeits|Use Istanbul cards and official taxis',
    'Mexico|7|B-|Cheap|Moderate|Easy|ATM skimmers|Beach theft|Use ATMs inside banks and hotel safes',
    'Thailand|8|B|Cheap|Moderate|Easy|Tuk-tuk scams|Gem scams|Agree prices before rides and avoid “free” tours',
    'Germany|9|A-|Expensive|Moderate|Easy|Festival theft|Transit pickpockets|Use inside pockets at events',
    'United Kingdom|10|A-|Expensive|Easy|Easy|Phone snatch|Ticket fraud|Pay contactless; avoid unofficial sellers',
    'Japan|11|A+|Moderate|Moderate|Easy|Bar scams|Lost items|Use IC cards and official night venues',
    'Austria|12|A|Expensive|Moderate|Easy|Tram pickpockets|Tour scams|Validate tickets and keep bags front-facing',
    'Greece|13|B|Moderate|Easy|Moderate|Taxi scams|Rental issues|Use licensed ferries and check rental contracts',
    'Malaysia|14|A-|Cheap|Easy|Easy|Snatch theft|ATM skimmers|Use ride-hail and keep bags cross-body',
    'Korea, Republic of (South Korea)|15|A|Moderate|Moderate|Easy|Phone scams|Transit crowding|Use T-money and keep devices secure',
    'Hong Kong|16|A-|Expensive|Easy|Easy|Market pickpockets|Phone scams|Use Octopus card; ignore unsolicited calls',
    'Netherlands|17|A-|Expensive|Easy|Easy|Bike theft|Station theft|Lock bikes twice and watch bags',
    'Portugal|18|B+|Moderate|Moderate|Easy|Car break-ins|Pickpockets|Empty cars at viewpoints; use city lots',
    'Saudi Arabia|19|A-|Moderate|Moderate|Easy|Legal issues|Traffic fines|Respect local laws and speed cameras',
    'United Arab Emirates|20|A|Expensive|Easy|Easy|Traffic fines|Heat stress|Use Nol card and plan indoor breaks',
    'Canada|21|A-|Expensive|Easy|Easy|Car break-ins|Phone theft|Keep gear out of sight at trailheads',
    'Australia|22|A-|Expensive|Easy|Easy|Beach theft|Sun risks|Use Opal/Myki; observe surf flags',
    'New Zealand|23|A|Expensive|Easy|Easy|Trailhead theft|Rural hazards|Leave no valuables in cars',
    'Singapore|24|A+|Expensive|Easy|Easy|Fines|Littering fines|Know local rules; e-payments everywhere',
    'Switzerland|25|A|Expensive|Moderate|Easy|Station theft|Crowd scams|Use Half-Fare; keep bags close',
    'Czechia|26|B+|Moderate|Moderate|Easy|Exchange scams|Old town theft|Use ATMs in banks; avoid street changers',
    'Ireland|27|A-|Expensive|Easy|Easy|Nightlife theft|Phone snatch|Use inside pockets in busy streets',
    'Belgium|28|A-|Expensive|Easy|Easy|Station theft|Festival pickpockets|Keep zips forward in crowds',
    'Norway|29|A|Expensive|Easy|Easy|Weather|Bike theft|Prepare for weather; lock bikes',
    'Sweden|30|A|Expensive|Easy|Easy|Bike theft|Festival theft|Tap-to-pay and watch bags',
    'Indonesia|31|B|Cheap|Moderate|Easy|Taxi overcharge|Beach theft|Use Blue Bird or apps; count change',
    'Vietnam|32|B|Cheap|Moderate|Moderate|Motorbike snatch|Tour scams|Keep phones inside; book reputable tours',
    'Taiwan|33|A-|Moderate|Moderate|Easy|Market theft|Typhoons|Carry cash lite; monitor weather',
    'Morocco|34|B|Cheap|Moderate|Moderate|Souk hustles|Taxi overcharge|Use petit taxi meters; negotiate first',
    'Argentina|35|C+|Cheap|Moderate|Moderate|Card skimming|Night theft|Use bank ATMs; keep small cash',
    'Chile|36|B+|Moderate|Moderate|Easy|Terminal theft|Protests|Use official buses; check advisories',
    'Croatia|37|B+|Moderate|Easy|Easy|High-season scams|Parking scams|Pay official lots; confirm bookings',
    'Poland|38|B+|Moderate|Moderate|Easy|Exchange issues|Old town theft|Avoid street kiosks; use banks',
    'Denmark|39|A|Expensive|Easy|Easy|Bike theft|Night pickpockets|Register bikes; tap-to-pay',
    'Finland|40|A|Expensive|Easy|Easy|Winter risk|Bike theft|Dress for cold; secure bikes',
    'Iceland|41|A-|Expensive|Easy|Easy|Weather shifts|Road ice|Book 4x4 in winter; check forecasts',
    'Slovenia|42|A-|Moderate|Easy|Easy|Trail mishaps|Car break-ins|Validate vignettes; park in lit areas',
    'Slovakia|43|B+|Moderate|Moderate|Easy|Pickpockets|Ticket checks|Validate tickets; carry small cash',
    'Hungary|44|B+|Moderate|Moderate|Easy|Taxi overcharge|Bar scams|Use licensed taxis; check menus',
    'Romania|45|B|Cheap|Moderate|Moderate|ATM skimmers|Rural driving|Use bank ATMs; drive by day',
    'Bulgaria|46|B|Cheap|Moderate|Moderate|Tram checks|Taxi overcharge|Use official apps; keep tickets',
    'Serbia|47|B|Cheap|Moderate|Moderate|Night theft|Unmetered taxis|Use app cabs; stay lit streets',
    'Montenegro|48|B|Moderate|Moderate|Moderate|Parking scams|Coastal theft|Use guarded lots; early starts',
    'North Macedonia|49|B|Cheap|Moderate|Moderate|Market theft|Night buses|Use tourist shuttles; day travel',
    'Albania|50|B-|Cheap|Moderate|Moderate|Road rules|Beach theft|Prefer daylight drives; secure parking',
    'Bosnia and Herzegovina|51|B-|Cheap|Moderate|Moderate|Memorial sensitivity|Road hazards|Use marked routes; respect sites',
    'Malta|52|A-|Expensive|Easy|Easy|Beach theft|Heat|Use lockers; hydrate',
    'Cyprus|53|A-|Moderate|Easy|Easy|Road left|Beach theft|Drive left; watch currents',
    'Luxembourg|54|A-|Expensive|Easy|Easy|Pickpockets|None major|Use free transit; central stays',
    'Monaco|55|A-|Expensive|Easy|Easy|Price shocks|Pickpockets|Day-trip by train from Nice',
    'Andorra|56|A-|Moderate|Moderate|Moderate|Winter roads|Altitude|Carry chains; fuel early',
    'San Marino|57|A-|Moderate|Moderate|Moderate|Crowd theft|Steep paths|Wear grip shoes; day-trip via Rimini',
    'Lithuania|58|A-|Moderate|Easy|Easy|Old town theft|Ticket checks|Tap-to-pay; validate tickets',
    'Latvia|59|A-|Moderate|Easy|Easy|Nightlife theft|Station theft|Keep bags front; use city passes',
    'Estonia|60|A-|Moderate|Easy|Easy|Bike theft|Winter ice|Lock bikes; walk carefully in ice',
    'Jordan|61|B|Moderate|Easy|Moderate|Desert hazards|Ticket touts|Use licensed guides; hydrate',
    'Oman|62|A-|Expensive|Moderate|Moderate|Desert driving|Heat|Use 4x4 for wadis; plan fuel',
    'Qatar|63|A-|Expensive|Easy|Easy|Road fines|Heat|Use metro; respect local rules',
    'Bahrain|64|A-|Moderate|Easy|Easy|Night driving|Heat|Use rideshares; hydrate',
    'Israel|65|B|Expensive|Easy|Easy|Security checks|Scams|Follow guidance; official routes only',
    'Georgia|66|B|Cheap|Moderate|Moderate|Mountain roads|Night theft|Hire vetted drivers; day travel',
    'Armenia|67|B|Cheap|Moderate|Moderate|Border zones|Rural roads|Use licensed drivers; carry cash',
    'Sri Lanka|68|B|Cheap|Moderate|Moderate|Beach touts|Train crowding|Reserve seats; day travel',
    'Nepal|69|B-|Cheap|Moderate|Moderate|Altitude|Night roads|Hire guides; monitor weather',
    'Bhutan|70|A-|Expensive|Moderate|Moderate|Mountain roads|Altitude|Book via authorized operators',
    'Uzbekistan|71|B|Cheap|Moderate|Moderate|Taxi overcharge|Pickpockets|Use Yandex/official cabs',
    'Kazakhstan|72|B|Moderate|Moderate|Moderate|Road checks|Night theft|Use city taxis; carry copies',
    'Kyrgyzstan|73|B-|Cheap|Moderate|Moderate|Mountain roads|Night buses|Use guides; day crossings',
    'Mauritius|74|A-|Expensive|Easy|Easy|Beach theft|Road left|Use hotel safes; drive left',
    'Seychelles|75|A-|Expensive|Moderate|Moderate|Beach theft|Currents|Beware rip currents; secure villas',
    'Fiji|76|B+|Moderate|Moderate|Moderate|Resort theft|Cyclones|Use safes; watch season',
    'Maldives|77|A-|Expensive|Moderate|Moderate|Resort theft|Currents|Follow island rules; guided snorkeling',
    'Rwanda|78|A-|Moderate|Moderate|Moderate|Road checks|Park rules|Book permits; use official guides',
    'Ghana|79|B|Moderate|Moderate|Moderate|Phone snatch|Market theft|Use hotel taxis; conceal phones',
    'Senegal|80|B|Moderate|Moderate|Moderate|Beach theft|Night roads|Use known areas; day trips',
    'Namibia|81|A-|Moderate|Moderate|Moderate|Desert driving|Wildlife|Fuel often; avoid night drives',
    'Botswana|82|A-|Expensive|Moderate|Moderate|Wildlife roads|Cash in villages|Guided safaris; cash small bills',
    'Zambia|83|B+|Moderate|Moderate|Moderate|Border touts|Night roads|Use official exchanges; day border runs',
    // Risk-only selection
    'Kenya|-|C+|Moderate|Moderate|Moderate|Mugging|Border terror|Use registered cabs; avoid isolated parks at night',
    'Tanzania|-|C+|Cheap|Moderate|Moderate|Snatch theft|Ferry theft|Use hotel taxis; keep phones hidden near roads',
    'Nigeria|-|D|Moderate|Moderate|Moderate|Kidnapping|Fraud|Use secure transfers; vary routes',
    'Ethiopia|-|D|Cheap|Moderate|Moderate|Civil unrest|Robbery|Avoid protests; shelter in secure hotels',
    'Egypt|-|C|Cheap|Moderate|Moderate|Harassment|Sinai terror|Dress modestly; licensed guides only',
    'Lebanon|-|D|Moderate|Moderate|Moderate|Unrest|Border kidnapping|Avoid protests; trusted drivers only',
    'Pakistan|-|D+|Cheap|Moderate|Moderate|Terror threats|Kidnapping|Avoid crowds; escorts where advised',
    'India|-|C+|Cheap|Moderate|Moderate|Scam hubs|Harassment|Prepaid taxis; keep copies of documents',
    'Dominican Republic|-|C|Moderate|Moderate|Moderate|Drink spiking|Resort theft|Use room safes; hotel taxis',
    'Jamaica|-|C|Moderate|Moderate|Moderate|Robbery|Assault|Avoid night walks; stay in known zones',
    'Belize|-|C|Moderate|Moderate|Moderate|District robberies|Night roads|Use authorized tours; avoid isolated beaches',
    'Paraguay|-|C|Cheap|Moderate|Moderate|Phone theft|ATM fraud|Use ride-hail; bank ATMs only',
    'Tunisia (south)|-|C|Cheap|Moderate|Moderate|Desert risk|Border terror|Avoid remote drives without permits',
    'Mozambique|-|C|Cheap|Moderate|Moderate|Break-ins|Armed robbery|Avoid dusk travel; guarded parking',
    'Madagascar|-|C|Cheap|Moderate|Moderate|Rural robbery|Night walking|Join daytime tours; avoid isolated roads',
    'Bolivia|-|C|Cheap|Moderate|Moderate|Bus theft|Currency scams|Use official counters; no night buses',
    'Honduras|-|D|Cheap|Moderate|Moderate|Gang violence|Robbery|Avoid secluded areas; travel in groups',
    'Guatemala|-|D|Cheap|Moderate|Moderate|Bus robberies|Extortion|Tourist shuttles; small cash only',
    'El Salvador|-|D|Cheap|Moderate|Moderate|Gang threats|Extortion|Main routes only; phones concealed',
    'Colombia|-|D+|Moderate|Moderate|Moderate|Express kidnapping|Robbery|Ride-hail; avoid street ATMs',
    'Brazil|-|D+|Moderate|Moderate|Moderate|Armed robbery|Carjacking|Avoid empty beaches at dusk',
    'Peru|-|C+|Cheap|Moderate|Moderate|Street robbery|Roadblocks|Join reputable tours; avoid isolated viewpoints',
    'Ecuador|-|D|Cheap|Moderate|Moderate|Kidnapping|Extortion|Avoid border hotspots; trusted taxis',
    'Trinidad and Tobago|-|D|Moderate|Moderate|Moderate|Shootings|Robbery|Hotel taxis; limit night travel',
    'South Africa|-|D|Moderate|Moderate|Moderate|Carjacking|Armed robbery|Doors locked; daylight routes'
  ];

  // Micronations (type:"micro")
  const MICROS=[
    {name:'Principality of Sealand',type:'micro',pop:'~30–50',gdp:'Unknown',leader:'Prince Michael',founded:'1967',pitch:'Micronation on a WW2 sea fort off England. Not a UN state.',story:'Founded by pirate-radio pioneer Roy Bates to broadcast beyond UK law. Issues titles and passports; dramatic 1978 coup attempt repelled. Listed as MICRONATION for clarity.'},
    {name:'Republic of Molossia',type:'micro',pop:'~35',gdp:'Unknown',leader:'President Kevin Baugh',founded:'1977',pitch:'Comedy-spirited desert micronation in Nevada, USA.',story:'Famous for whimsical customs, a space program, and a declared war on East Germany until 2018. Tours book out months ahead. MICRONATION only.'},
    {name:'Liberland',type:'micro',pop:'~700k e-citizens',gdp:'Unknown',leader:'President Vít Jedlička',founded:'2015',pitch:'Claim on Danube river island between Croatia and Serbia.',story:'Founded on terra nullius concept; residents mainly online with libertarian ideals. Border access is limited. MICRONATION, not a UN state.'},
    {name:'Kingdom of North Sudan',type:'micro',pop:'<10',gdp:'Unknown',leader:'Jeremiah Heaton',founded:'2014',pitch:'Bir Tawil claim between Egypt and Sudan.',story:'Started as a father’s promise to make his daughter a princess. Purely symbolic; no recognition. MICRONATION label applies.'},
    {name:'Grand Duchy of Flandrensis',type:'micro',pop:'~8k citizens',gdp:'Unknown',leader:'Grand Duke Nikolaus',founded:'2008',pitch:'Claims in Antarctica for climate advocacy.',story:'No land occupation; promotes environmental protection and “no human presence in Antarctica”. Recognized as a MICRONATION only.'},
    {name:'Duchy of Sealand New Malta',type:'micro',pop:'Unknown',gdp:'Unknown',leader:'Various',founded:'—',pitch:'Minor offshoot projects around sea-fort concept.',story:'Community experiments; not territorial states. MICRONATION.'},
    {name:'Principality of Hutt River',type:'micro',pop:'Defunct (former)',gdp:'—',leader:'Prince Graeme (former)',founded:'1970',pitch:'Former Australian farm secession project.',story:'Closed in 2020; kept for cultural history. MICRONATION (historic).'},
    {name:'Kingdom of Talossa',type:'micro',pop:'~2k',gdp:'Unknown',leader:'King John',founded:'1979',pitch:'Fantasy kingdom created by a teenager in Milwaukee.',story:'Rich culture with its own language. Online-first, MICRONATION only.'},
    {name:'Ladonia',type:'micro',pop:'~22k online',gdp:'Unknown',leader:'Queen Carolyn',founded:'1996',pitch:'Art-state in a Swedish nature reserve.',story:'Born from legal battles over sculpture “Nimis”. Citizenship mostly virtual. MICRONATION.'},
    {name:'Principality of Seborga',type:'micro',pop:'~300',gdp:'Unknown',leader:'Prince Marcello I',founded:'1990s revival',pitch:'Italian hill town with princely lore.',story:'Touristic pageantry claims medieval independence. Cultural MICRONATION.'},
    {name:'Asgardia',type:'micro',pop:'~1M e-citizens',gdp:'Unknown',leader:'Igor Ashurbeyli',founded:'2016',pitch:'Space-themed online nation.',story:'Launched a micro-satellite; seeks space law debates. No territory; MICRONATION.'},
    {name:'Westarctica',type:'micro',pop:'~3k citizens',gdp:'Unknown',leader:'Grand Duke Travis',founded:'2001',pitch:'Claims Marie Byrd Land, Antarctica.',story:'Focus on conservation and charity; symbolic claim. MICRONATION.'},
    {name:'Wirtland',type:'micro',pop:'~3k',gdp:'Unknown',leader:'Chancellor (var.)',founded:'2008',pitch:'Internet-based transnational micronation.',story:'Issued “phaleras” and ID cards. Purely virtual; MICRONATION.'},
    {name:'Christiania (Freetown)',type:'micro',pop:'~1k',gdp:'Unknown',leader:'Collective',founded:'1971',pitch:'Autonomous neighborhood in Copenhagen.',story:'Self-governed commune famous for art and green light district. Not a state; MICRONATION tag added.'},
    {name:'Akhzivland',type:'micro',pop:'<20',gdp:'Unknown',leader:'Eli Avivi (founder, late)',founded:'1971',pitch:'Tiny cultural enclave in Israel.',story:'Run as a private museum-village. Tourist curiosity; MICRONATION.'}
  ];

  const DB={}, ITEMS=TOK.map(mkObj); for(const o of ITEMS){DB[asString(o.name).toLowerCase()]=o}
  MICROS.forEach(m=>{ DB[m.name.toLowerCase()]=m });

  const UN_STR='Afghanistan|Albania|Algeria|Andorra|Angola|Antigua and Barbuda|Argentina|Armenia|Australia|Austria|Azerbaijan|Bahamas|Bahrain|Bangladesh|Barbados|Belarus|Belgium|Belize|Benin|Bhutan|Bolivia|Bosnia and Herzegovina|Botswana|Brazil|Brunei|Bulgaria|Burkina Faso|Burundi|Cabo Verde|Cambodia|Cameroon|Canada|Central African Republic|Chad|Chile|China|Colombia|Comoros|Congo|Costa Rica|Côte d’Ivoire|Croatia|Cuba|Cyprus|Czechia|Democratic Republic of the Congo|Denmark|Djibouti|Dominica|Dominican Republic|Ecuador|Egypt|El Salvador|Equatorial Guinea|Eritrea|Estonia|Eswatini|Ethiopia|Fiji|Finland|France|Gabon|Gambia|Georgia|Germany|Ghana|Greece|Grenada|Guatemala|Guinea|Guinea-Bissau|Guyana|Haiti|Honduras|Hungary|Iceland|India|Indonesia|Iran|Iraq|Ireland|Israel|Italy|Jamaica|Japan|Jordan|Kazakhstan|Kenya|Kiribati|Korea, Republic of (South Korea)|Kuwait|Kyrgyzstan|Lao PDR|Latvia|Lebanon|Lesotho|Liberia|Libya|Liechtenstein|Lithuania|Luxembourg|Madagascar|Malawi|Malaysia|Maldives|Mali|Malta|Marshall Islands|Mauritania|Mauritius|Mexico|Micronesia|Moldova|Monaco|Mongolia|Montenegro|Morocco|Mozambique|Myanmar|Namibia|Nauru|Nepal|Netherlands|New Zealand|Nicaragua|Niger|Nigeria|North Macedonia|Norway|Oman|Pakistan|Palau|Panama|Papua New Guinea|Paraguay|Peru|Philippines|Poland|Portugal|Qatar|Romania|Russian Federation|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and the Grenadines|Samoa|San Marino|Sao Tome and Principe|Saudi Arabia|Senegal|Serbia|Seychelles|Sierra Leone|Singapore|Slovakia|Slovenia|Solomon Islands|Somalia|South Africa|South Sudan|Spain|Sri Lanka|Sudan|Suriname|Sweden|Switzerland|Syrian Arab Republic|Tajikistan|Tanzania|Thailand|Timor-Leste|Togo|Tonga|Trinidad and Tobago|Tunisia|Turkey|Turkmenistan|Tuvalu|Uganda|Ukraine|United Arab Emirates|United Kingdom|United States|Uruguay|Uzbekistan|Vanuatu|Venezuela|Viet Nam|Yemen|Zambia|Zimbabwe';
  const UN=UN_STR.split('|');

  // Ensure DB has an entry for every UN country; add info-limited placeholder if missing
  UN.forEach(n=>{ const k=n.toLowerCase(); if(!DB[k]){ DB[k]={name:n,key:k,rank:null,grade:'NA',cost:'Unknown',eng:'Unknown',fx:'Unknown',r1:'—',r2:'—',tip:'Information limited; check official advisories.',type:'country'} }});

  // Collections
  const ITEMS2=Object.values(DB);
  const GOOD=ITEMS2.filter(o=>o.rank!=null && !o.type).sort((a,b)=>a.rank-b.rank);
  const RISK_ALL=ITEMS2.filter(o=>!o.type && riskRe.test(o.grade||''));
  const RISK_SORTED=RISK_ALL.slice().sort((a,b)=>(gradeOrder[a.grade]??99)-(gradeOrder[b.grade]??99)||a.name.localeCompare(b.name));
  const MICRONAMES=MICROS.map(m=>m.name).sort();

  // Datalist (one-line)
  const names=UN.concat(MICRONAMES).sort((a,b)=>a.localeCompare(b));
  names.forEach(n=>{ const o=DB[n.toLowerCase()]; let label=o.name; if(o.type==='micro') label+=' (MICRONATION)'; else if(riskRe.test(o.grade||'')) label+=' (RISK)'; else if(o.rank!=null) label+=` (SAFE #${o.rank})`; else label+=' (INFO-LIMITED)'; const op=document.createElement('option'); op.value=label; dl.appendChild(op); });

  // Interest / hover behaviour — instant deep view + slower rotation while hovered
  let mode='core', rotId=null, visible=true, userLock=null, goodIdx=0, phase='good';
  function step(){ if(phase==='good'){ const o=GOOD[goodIdx % GOOD.length]; goodIdx++; show(o,false); phase='risk'; } else { const o=pick(RISK_ALL); show(o,false); phase='good'; } }
  function startAuto(){ if(rotId||!visible) return; rotId=setInterval(()=>{ if(!userLock&&visible){ step() } }, rotDelay) }
  function stopAuto(){ clearInterval(rotId); rotId=null }
  function lock(){ if(userLock) clearTimeout(userLock); stopAuto(); userLock=setTimeout(()=>{ userLock=null; startAuto(); }, USER_LOCK_MS) }

  // Inputs
  q.addEventListener('focus',()=>{ stopAuto() });
  q.addEventListener('blur',()=>{ startAuto() });
  q.addEventListener('mouseenter',()=>{ q.value=''; q.style.color=''; });
  q.addEventListener('pointerdown',()=>{ q.value=''; q.style.color=''; });

  // Hover → instant deep + 40s rotation; leave → core + 20s rotation
  box.addEventListener('pointerenter',()=>{ mode='deep'; rotDelay=ROT_HOVER; stopAuto(); startAuto(); show(curr,false) });
  box.addEventListener('pointerleave',()=>{ mode='core'; rotDelay=ROT_DEFAULT; stopAuto(); startAuto(); show(curr,false) });

  // Visibility
  const io=new IntersectionObserver(es=>{ es.forEach(e=>{ visible=e.isIntersecting; if(visible) startAuto(); else stopAuto(); }) }); io.observe(box);

  // Heights
  let roPending=false,lastFull=0,lastCol=0;
  function recalc(){ try{ const prev=box.style.maxHeight; box.style.maxHeight='none'; const full=box.scrollHeight; const collapsed=Math.max(MIN_COLLAPSED, Math.round(full*COLLAPSE_PCT)); box.style.maxHeight=prev; if(full===lastFull&&collapsed===lastCol) return; lastFull=full; lastCol=collapsed; box.style.setProperty('--expanded-h', full+'px'); box.style.setProperty('--collapsed-h', collapsed+'px'); }catch(_){} }
  function qRec(){ if(roPending) return; roPending=true; requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ roPending=false; recalc(); }) }) }
  if('ResizeObserver' in window){ const ro=new ResizeObserver(()=>qRec()); ro.observe(view) }
  window.addEventListener('resize',qRec);
  document.addEventListener('visibilitychange',()=>{ document.hidden?stopAuto():startAuto(); qRec(); });

  // Renderers
  let curr=null, cycId=null;
  function displayName(o){ if(o.type==='micro') return `${o.name} (MICRONATION)`; if(riskRe.test(o.grade||'')) return `${o.name} (RISK)`; if(o.rank!=null) return `${o.name} (SAFE #${o.rank})`; return `${o.name} (INFO-LIMITED)` }
  function updatePeriod(name){ const c=creditInfo(name); elP.innerHTML = `${LABELS.assessed} 2020-01-01 ${LABELS.to} 2024-10-01 <span class="brkt">【 <span class="badge ${c.cls}">${LABELS.moody}: ${c.text}</span> 】</span>` }
  function show(o,user){ if(!o||typeof o!=='object') return; curr=o; const risky=riskRe.test(o.grade||''); elN.textContent=displayName(o); elR.innerHTML=(o.type==='micro')?`(${LABELS.micro})`:(o.rank?(`${LABELS.rank}`+o.rank):'(Unranked)'); if(o.type==='micro'){ elG.innerHTML='<strong>'+LABELS.micro+'</strong> <span class="brkt">【 '+LABELS.notun+' 】</span>';  elD.textContent=core(o); elM.innerHTML='<div>'+full(o)+'</div>'; } else { const exp=GEXP[o.grade||'NA']||GEXP.NA; elG.innerHTML='<strong>'+LABELS.sgrade+' <span class="badge '+gColor(o.grade)+'">'+(o.grade||'NA')+'</span></strong> <span class="brkt">【 '+exp+' 】</span>'; elG.classList.remove('green','black','red'); elG.classList.add(gColor(o.grade||'NA')); elD.textContent=core(o); elM.innerHTML = (mode==='deep')?('<div>'+full(o)+'</div>') : ''; }
    updatePeriod(o.name);
    qRec(); if(user){ save(o.name); lock(); setQuery(o.name); if(o.rank!=null){ const idx=GOOD.findIndex(x=>x.key===o.key); if(idx>-1){ goodIdx=idx+1; phase='risk'; } } else if(risky){ phase='good' } }
    sr.textContent=o.name+' loaded.' }
  function render(input){ const txt=cleanInput(input); if(!txt){ elN.textContent='—'; elR.textContent='—'; elG.textContent='—'; elD.textContent=LABELS.choose; elM.innerHTML=''; qRec(); return } const key=bestMatch(txt)||txt.toLowerCase(); const hit=DB[key]; if(hit) show(hit,true) }

  // URL state
  function getQuery(){ try{ const u=new URL(location.href); return u.searchParams.get('country')||'' } catch(_){ return '' } }
  function setQuery(c){ try{ const u=new URL(location.href); if(c){ u.searchParams.set('country',c) } else { u.searchParams.delete('country') } history.replaceState(null,'',u) } catch(_){} }

  // Events
  riskBtn.addEventListener('click',(()=>{ let i=0; return ()=>{ const o=RISK_SORTED[i % RISK_SORTED.length]; i++; show(o,true); } })());
  q.addEventListener('change',function(){ const v=cleanInput(this.value); const key=bestMatch(v)||v.toLowerCase(); if(DB[key]) show(DB[key],true) });
  let live=null; q.addEventListener('input',function(){ clearTimeout(live); const v=cleanInput(this.value); const k=bestMatch(v)||v.toLowerCase(); const g=(DB[k]||{}).grade||''; this.style.color=/^d|^e|^f/i.test(g)?'#b01919':''; live=setTimeout(()=>render(v),250) });

  // Tests (kept, EN only)
  (function tests(){ try{ console.group('[Ticker tests]'); const unCount=UN.length; console.assert(unCount>=193,'UN coverage ≥193'); console.assert(!!DB['united states'],'United States present'); console.assert(MICROS.length>=10,'Micronations ≥10'); console.assert((Object.values(DB).filter(o=>o.rank!=null && !o.type).length)>=80,'ranked sample present'); console.assert(riskRe.test('D+')&&riskRe.test('E')&&riskRe.test('F'),'riskRe covers D/E/F'); console.assert(bestMatch('usa')==='united states','alias usa→united states'); console.assert(bestMatch('jp')==='japan','alias jp→japan'); console.assert(bestMatch('kr')==='korea, republic of (south korea)','alias kr→south korea'); recalc(); const colH=parseInt(getComputedStyle(box).getPropertyValue('--collapsed-h'))||MIN_COLLAPSED; console.assert(colH>=MIN_COLLAPSED,'collapsed ≥ baseline'); updatePeriod('Luxembourg'); console.assert(/【/.test(elP.innerHTML)&&/Moody/.test(elP.innerHTML),'period shows bracket+Moody'); console.groupEnd(); }catch(err){ console.error('[Ticker tests] failed',err) } })();

  // Init
  (function init(){ const seedName=cleanInput(getQuery()||load()||'Japan'); const seed=DB[(seedName||'').toLowerCase()]||DB['japan']; show(seed,false); recalc(); startAuto(); })();
})();
</script>
