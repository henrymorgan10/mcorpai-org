<!-- === Scam-Compound Risk (vanilla HTML only, EN-only UI, no JSON, no server) ===
Paste near the end of <body>. Uses only Wikipedia's public API from the browser.
This version tightens signal quality by filtering results where "scam|fraud" appears
within 40 characters of "compound" in the snippet, instead of relying on totalhits.
Classification thresholds are made conservative to prevent all-High outcomes.
Also includes a top "Live update" button and compact styling. -->

<section id="scam-panel" aria-label="Real-time Scam-Compound Risk" style="max-width:920px;margin:14px auto;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:rgba(232,255,241,.5);backdrop-filter:saturate(1.05) blur(4px);-webkit-backdrop-filter:saturate(1.05) blur(4px);box-shadow:0 6px 16px rgba(2,6,23,.06)">
  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
    <h3 style="margin:0;font-size:.95rem;font-weight:800;color:#111;display:flex;align-items:center;gap:6px">
      Real-time Scam-Compound Risk <span style="font-weight:600;color:#6b7280">(click "Live update" to refresh)</span>
    </h3>
    <button id="scam-btn-top" type="button" aria-label="Live update" title="Live update" style="font-size:.78rem;font-weight:700;border:1px solid rgba(0,0,0,.18);background:#fff;box-shadow:0 2px 6px rgba(2,6,23,.05);padding:5px 9px;border-radius:8px;cursor:pointer">Live update</button>
    <span id="scam-status" style="font-size:.78rem;color:#6b7280"></span>
  </div>

  <p style="margin:6px 0 8px;font-size:.8rem;color:#6b7280">
    A concise indicator based on open-source mentions in Wikipedia search. This is not a verification or legal finding.
  </p>

  <div style="display:flex;gap:8px;align-items:center;justify-content:flex-start;margin:4px 0 6px">
    <button id="scam-btn" type="button" style="font-size:.78rem;font-weight:700;border:1px solid rgba(0,0,0,.18);background:#fff;box-shadow:0 2px 6px rgba(2,6,23,.05);padding:5px 9px;border-radius:8px;cursor:pointer">Live update</button>
  </div>

  <div role="status" aria-live="polite" style="text-align:left;font-size:.84rem;color:#111;letter-spacing:.05px;margin:4px 0 0">
    <span style="font-weight:800;margin-right:6px">Scam-Compound Index:</span>
    <span id="scam-line">Loading…</span>
  </div>
</section>

<style>
  #scam-panel .country{color:#111;font-weight:700}
  #scam-panel .risk-high{color:#ef4444;font-weight:800}
  #scam-panel .risk-med{color:#f59e0b;font-weight:800}
  #scam-panel .risk-low{color:#10b981;font-weight:800}
  #scam-panel .pulse{animation:pulse-bg .26s linear 1}
  @keyframes pulse-bg{from{background-color:rgba(255,255,0,.12)}to{background-color:transparent}}
</style>

<script>
(function(){
  const line   = document.getElementById('scam-line');
  const btn    = document.getElementById('scam-btn');
  const btnTop = document.getElementById('scam-btn-top');
  const status = document.getElementById('scam-status');
  if(!line) return;

  function word(r){
    r = String(r||'HIGH').toUpperCase();
    if(r==='HIGH') return {w:'High', cls:'risk-high'};
    if(r==='LOW')  return {w:'Low',  cls:'risk-low'};
    return {w:'Medium', cls:'risk-med'};
  }
  const esc = s => String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));

  // Baseline shown immediately (as requested)
  const BASELINE = [
    {country:'Laos',        risk:'HIGH',  city:'Golden Triangle SEZ',  pattern:'Coerced cyberfraud / movement restriction', last:'2025-07-20'},
    {country:'Myanmar',     risk:'HIGH',  city:'Myawaddy SEZ',         pattern:'Human trafficking / fenced compounds',       last:'2025-07-29'},
    {country:'Thailand',    risk:'HIGH',  city:'Border belt',          pattern:'Forced scamming / passport confiscation',    last:'2025-07-10'},
    {country:'Cambodia',    risk:'HIGH',  city:'Sihanoukville',        pattern:'Compelled online scams / document seizure',  last:'2025-06-30'},

    {country:'China',       risk:'MED',   city:'Coastal clusters',     pattern:'Online fraud hubs shifting locations',       last:'2025-07-18'},
    {country:'Indonesia',   risk:'MED',   city:'Batam',                pattern:'Cross-border cyberfraud crews',              last:'2025-07-02'},
    {country:'Malaysia',    risk:'MED',   city:'Johor Bahru',          pattern:'Call-center style scam workshops',           last:'2025-07-05'},
    {country:'Philippines', risk:'MED',   city:'Clark area',           pattern:'Recruitment scams targeting foreigners',     last:'2025-06-12'},
    {country:'Vietnam',     risk:'MED',   city:'Ho Chi Minh City',     pattern:'Tech-support vacancy lures',                 last:'2025-06-28'},

    {country:'Bangladesh',  risk:'LOW',   city:'—',                    pattern:'Monitoring potential recruitment hubs',      last:'2025-07-12'},
    {country:'Sri Lanka',   risk:'LOW',   city:'—',                    pattern:'Monitoring potential recruitment hubs',      last:'2025-07-15'},
    {country:'UAE',         risk:'LOW',   city:'Dubai',                pattern:'Sham job offers leading to debt bondage',    last:'2025-05-02'}
  ];

  function renderBaseline(){
    const parts = BASELINE.map(x=>{
      const W = word(x.risk);
      const tip = [x.city?`City: ${x.city}`:'', x.pattern?`Pattern: ${x.pattern}`:'', x.last?`Last: ${new Date(x.last).toISOString().slice(0,10)}`:''].filter(Boolean).join(' · ');
      return `<span class="country" title="${esc(tip)}">${esc(x.country)}</span> <span class="${W.cls}">${W.w}</span>`;
    });
    line.innerHTML = parts.join(', ');
  }

  // Wikipedia search set-up (refined)
  const COUNTRIES = [
    {name:'Laos',        alt:'Lao PDR'},
    {name:'Myanmar',     alt:'Burma'},
    {name:'Thailand'},
    {name:'Cambodia'},
    {name:'China'},
    {name:'Indonesia'},
    {name:'Malaysia'},
    {name:'Philippines'},
    {name:'Vietnam',     alt:'Viet Nam'},
    {name:'Bangladesh'},
    {name:'Sri Lanka'},
    {name:'United Arab Emirates', alt:'UAE'}
  ];

  // Exact phrases only to avoid generic hits
  const TERMS = '"scam compound" OR "fraud compound" OR "cyber scam compound" OR "forced scamming compound"';
  const API   = 'https://en.wikipedia.org/w/api.php';

  // Conservative classification using filtered hits only (not totalhits)
  function classify(filteredHits, days){
    const h = Number(filteredHits||0);
    const d = Number.isFinite(days)? days : 9999;
    if(h === 0) return 'LOW';
    if(h >= 6 && d <= 180) return 'HIGH';
    if(h >= 2 && d <= 365) return 'MED';
    return 'LOW';
  }

  async function fetchWiki(country){
    const qCountry = country.alt ? `(${country.name} OR "${country.alt}")` : country.name;
    const query = `(${TERMS}) ${qCountry}`;
    const url = `${API}?action=query&list=search&format=json&origin=*&srnamespace=0&srinfo=totalhits&srsort=last_edit_desc&srqiprofile=classic_noboostlinks&srlimit=50&srprop=timestamp|snippet&srsearch=${encodeURIComponent(query)}`;
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    const items = data?.query?.search || [];

    // Keep only items whose snippet mentions scam|fraud within 40 chars of compound
    const filtered = items.filter(it=>{
      const s = String(it.snippet||'').replace(/<[^>]+>/g,' ').toLowerCase();
      return /(scam|fraud).{0,40}compound|compound.{0,40}(scam|fraud)/.test(s);
    });

    const hits = filtered.length;
    const mostRecent = filtered.reduce((max, it)=>{
      const t = Date.parse(it.timestamp || 0);
      return isNaN(t) ? max : Math.max(max, t);
    }, 0);
    const days = mostRecent ? Math.round((Date.now() - mostRecent) / (1000*60*60*24)) : Infinity;
    return {name: country.name.includes('United Arab Emirates') ? 'UAE' : country.name, risk: classify(hits, days), hits, days};
  }

  function render(items){
    if(!items.length){ line.textContent = 'No data'; return; }
    const parts = items.map(x=>{
      const W = word(x.risk);
      const tip = `Signal: Wikipedia search · Filtered hits: ${x.hits ?? '—'} · Most recent: ${Number.isFinite(x.days)? x.days+'d ago' : 'n/a'}`;
      return `<span class="country" title="${esc(tip)}">${esc(x.name)}</span> <span class="${W.cls}">${W.w}</span>`;
    });
    const html = parts.join(', ');
    if(line.innerHTML !== html){
      line.innerHTML = html;
      line.parentElement.classList.add('pulse');
      setTimeout(()=> line.parentElement.classList.remove('pulse'), 260);
    }
  }

  async function refreshLive(){
    try{
      status.textContent = 'Fetching Wikipedia signals…';
      btn && (btn.disabled = true);
      btnTop && (btnTop.disabled = true);
      const results = await Promise.allSettled(COUNTRIES.map(fetchWiki));
      const ok = results.filter(r=>r.status==='fulfilled').map(r=>r.value);
      if(ok.length){
        const rank = {HIGH:3, MED:2, LOW:1};
        render(ok.sort((a,b)=> rank[b.risk]-rank[a.risk] || a.name.localeCompare(b.name)));
        status.textContent = 'Live signals applied';
      }else{
        status.textContent = 'No signals; baseline retained';
      }
    }catch(e){
      status.textContent = 'Fetch failed; baseline retained';
    }finally{
      btn && (btn.disabled = false);
      btnTop && (btnTop.disabled = false);
      setTimeout(()=>{ status.textContent=''; }, 4000);
    }
  }

  // Init
  renderBaseline();
  status.textContent = 'Baseline shown';

  btn    && btn.addEventListener('click', refreshLive);
  btnTop && btnTop.addEventListener('click', refreshLive);
})();
</script>
